# Task Tracker API

Веб-сервис для управления задачами с аналитикой и визуализацией данных.

## Описание проекта

Трекер задач - это RESTful API приложение, построенное на FastAPI, которое позволяет:
- Управлять задачами (CRUD операции)
- Фильтровать задачи по различным критериям
- Отслеживать статусы задач (новая, в работе, сделано и др.)
- Получать аналитику по задачам (группировка по статусам, темам, исполнителям)
- Визуализировать статистику с помощью графиков

## Технологический стек

- **Python 3.10+**
- **FastAPI** - современный веб-фреймворк
- **PostgreSQL** - реляционная база данных
- **SQLAlchemy** - ORM для работы с БД
- **Alembic** - миграции базы данных
- **Pandas** - анализ данных
- **Matplotlib** - визуализация данных
- **Pytest** - тестирование
- **JWT** - аутентификация
- **Bcrypt** - хеширование паролей

## Структура базы данных

### ERD диаграмма

```
┌─────────────┐         ┌─────────────┐
│    User     │◄────────│    Task     │
│             │         │             │
│ - id        │         │ - id        │
│ - username  │         │ - title     │
│ - email     │         │ - status    │
│ - password  │         │ - assignee  │
└─────────────┘         │ - category  │
                        └─────────────┘
                               │
                               │
                        ┌──────▼──────┐
                        │  Category   │
                        │             │
                        │ - id        │
                        │ - name      │
                        └─────────────┘
```

### Модели данных

#### User (Пользователь/Исполнитель)
- `id` - первичный ключ
- `username` - уникальное имя пользователя
- `email` - уникальный email
- `hashed_password` - хешированный пароль
- `full_name` - полное имя
- `created_at` - дата создания

#### Task (Задача)
- `id` - первичный ключ
- `title` - название задачи
- `description` - описание
- `status` - статус (новая, в работе, сделано, отменена, на паузе)
- `priority` - приоритет (0-низкий, 1-средний, 2-высокий)
- `assignee_id` - внешний ключ на User (исполнитель)
- `category_id` - внешний ключ на Category
- `created_at` - дата создания
- `updated_at` - дата обновления
- `due_date` - срок выполнения

#### Category (Категория/Тема)
- `id` - первичный ключ
- `name` - название категории
- `description` - описание
- `created_at` - дата создания

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd db-setup
```

### 2. Создание виртуального окружения

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка базы данных

Убедитесь, что PostgreSQL запущен и создайте базу данных:

```bash
createdb task_tracker
```

Или используйте существующую базу данных. Настройте подключение в переменных окружения:

```bash
export DATABASE_URL="postgresql://username:password@localhost:5432/task_tracker"
export SECRET_KEY="your-secret-key-here"
```

### 5. Применение миграций

```bash
alembic upgrade head
```

### 6. Запуск приложения

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

Приложение будет доступно по адресу: http://localhost:8000

Документация API (Swagger): http://localhost:8000/docs

## Использование API

### Аутентификация

Все защищенные endpoints требуют JWT токен в заголовке `Authorization: Bearer <token>`.

#### Регистрация пользователя

```bash
POST /api/auth/register
{
  "username": "user1",
  "email": "user1@example.com",
  "password": "password123",
  "full_name": "John Doe"
}
```

#### Вход

```bash
POST /api/auth/login
{
  "username": "user1",
  "password": "password123"
}

# Ответ:
{
  "access_token": "eyJ...",
  "token_type": "bearer"
}
```

### CRUD операции с задачами

#### Создание задачи

```bash
POST /api/tasks
Authorization: Bearer <token>
{
  "title": "Реализовать API",
  "description": "Создать REST API для трекера задач",
  "status": "новая",
  "priority": 2,
  "category_id": 1
}
```

#### Получение списка задач

```bash
GET /api/tasks?status=новая&category_id=1&search=API
Authorization: Bearer <token>
```

#### Получение задачи по ID

```bash
GET /api/tasks/1
Authorization: Bearer <token>
```

#### Обновление задачи

```bash
PUT /api/tasks/1
Authorization: Bearer <token>
{
  "status": "в работе",
  "priority": 1
}
```

#### Удаление задачи

```bash
DELETE /api/tasks/1
Authorization: Bearer <token>
```

### Фильтрация задач

Поддерживаются следующие параметры фильтрации:
- `status` - фильтр по статусу
- `assignee_id` - фильтр по исполнителю
- `category_id` - фильтр по категории
- `search` - поиск по названию и описанию

### Аналитика

#### Получение статистики

```bash
GET /api/analytics/stats
Authorization: Bearer <token>

# Ответ:
{
  "by_status": {
    "новая": 5,
    "в работе": 3,
    "сделано": 10
  },
  "by_assignee": {
    "user1": 8,
    "user2": 10
  },
  "by_category": {
    "Development": 12,
    "Testing": 6
  },
  "total_tasks": 18
}
```

#### Визуализация данных

```bash
GET /api/analytics/visualize
Authorization: Bearer <token>
```

Создает файл `task_analytics.png` с графиками:
- Распределение задач по статусам
- Распределение задач по исполнителям
- Распределение задач по категориям
- Распределение задач по приоритетам

## Тестирование

Запуск всех тестов:

```bash
pytest
```

Запуск с покрытием:

```bash
pytest --cov=. --cov-report=html
```

Тесты покрывают:
- Аутентификацию и авторизацию
- CRUD операции для задач
- Фильтрацию задач
- Аналитику и визуализацию
- Работу с базой данных
- Защиту от SQL-инъекций

## Безопасность

### Реализованные меры защиты:

1. **Аутентификация через JWT токены**
   - Токены имеют срок действия (30 минут)
   - Все защищенные endpoints требуют валидный токен

2. **Хеширование паролей**
   - Используется bcrypt для безопасного хранения паролей
   - Пароли никогда не передаются в открытом виде

3. **Защита от SQL-инъекций**
   - Все запросы выполняются через SQLAlchemy ORM
   - Используются параметризованные запросы
   - Входные данные валидируются через Pydantic

4. **Валидация данных**
   - Все входные данные проверяются через Pydantic схемы
   - Проверка типов и форматов данных

## Структура проекта

```
db-setup/
├── alembic/              # Миграции базы данных
│   ├── versions/
│   └── env.py
├── tests/                # Тесты
│   ├── test_api.py
│   └── test_db.py
├── main.py              # FastAPI приложение
├── models.py            # Модели SQLAlchemy
├── requirements.txt     # Зависимости
├── alembic.ini         # Конфигурация Alembic
└── README.md           # Документация
```

## Критерии выполнения задания

**Проект выполнен согласно условиям** (20 баллов)
- CRUD для задач
- Фильтрация задач
- Изменение статусов
- Аналитика и статистика

**Код соответствует PEP 8** (10 баллов)
- Структурированный код
- Комментарии и docstrings
- Правильное именование

**Покрытие тестами** (10 баллов)
- Тесты для всех CRUD операций
- Тесты фильтрации
- Тесты аналитики
- Тесты безопасности

**Оптимальная структура данных** (5 баллов)
- Правильные связи между таблицами
- Индексы для оптимизации запросов
- Нормализация данных

**Базовый функционал безопасности** (5 баллов)
- JWT аутентификация
- Хеширование паролей
- Защита от SQL-инъекций
- Валидация входных данных

## Автор

Проект выполнен в рамках учебного задания.

## Лицензия

MIT

